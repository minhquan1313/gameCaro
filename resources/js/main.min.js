function isFullScreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)}function run(){const caro=[],minReachedToWin=5,amountSquare=parseInt(playGround.gData("square")),squareRes=playGround.gData("width");let currentZoom=1,lastCurrentZoom=1;const zoomMin=1,zoomMax=3;let dragged=!1;const users=initUser();function interact(){const cl="active";let eX,eY,startX,startY,diffX,diffY,down=!1,lastX=0,lastY=0,doubleX,doubleY,doubleStartLength,doubleDiffLength,doubleDown=!1,lastZoom=0,dragging=!1,getXYFirstTimeTimeOut,type="";const animationDuration=300,animationEasing="easeOutQuint",ele=playGround,limitRes=amountSquare*parseInt(squareRes);function getXYFirstTime(){diffX=0,diffY=0,currentZoom=1,lastX=diffX,lastY=diffY}function getEX(e){return e.x||e.touches[0].clientX}function getEY(e){return e.y||e.touches[0].clientY}function getEXDouble(e){return e.x||e.touches[1].clientX}function getEYDouble(e){return e.y||e.touches[1].clientY}function calTwoPointsLength(a,b,aa,bb){return Math.sqrt(Math.pow(a-aa,2)+Math.pow(b-bb,2))}function mdown(e){if(type||(type="touchstart"==e.type?"touchend":"mouseup"),down)return doubleDown=!0,doubleX=getEXDouble(e),doubleY=getEYDouble(e),void(doubleStartLength=calTwoPointsLength(doubleX,doubleY,getEX(e)||eX,getEY(e)||eY));down=!0,startX=getEX(e)-lastX,startY=getEY(e)-lastY}function mup(e){if(doubleDown)return doubleDown=!1,startX=-diffX+getEX(e),startY=-diffY+getEY(e),void(lastCurrentZoom=currentZoom);down=!1,lastX=diffX||0,lastY=diffY||0,type==e.type&&clickCheck(e)}function clickCheck(e){if(!dragging){let square=e.target.closest(".square");square&&updateGame(square)}dragging=!1}function mmove(e){if(down||doubleDown){if(eX=getEX(e),eY=getEY(e),doubleDown){doubleX=getEXDouble(e),doubleY=getEYDouble(e);const newLength=calTwoPointsLength(doubleX,doubleY,eX,eY);doubleDiffLength=newLength-doubleStartLength;let zoom,percentZoom=doubleDiffLength/window.innerHeight;return zoomGame(10*percentZoom),dragging||(dragging=!0),void(lastZoom=percentZoom)}diffX=-(startX-eX),diffY=-(startY-eY),ele.style.transform=`translate(${diffX}px,${diffY}px)`,dragging||diffX==lastX||diffY==lastY||(dragging=!0),dragged||(dragged=!0)}}function zoomGame(strength){currentZoom=lastCurrentZoom+strength,currentZoom<1&&(currentZoom=1),currentZoom>3&&(currentZoom=3),playGround.style.zoom=currentZoom}function updateGame(square=ele){let obCaro={};obCaro=square.hasCl(cl)?updateRemove(square,cl):updateAdd(square,cl),obCaro.hasOwnProperty("checkWin")&&checkWin(obCaro)&&alert(obCaro.userName+" IS WINNER!!!")}function updateRemove(square,cl){users.prevUser();let order=users.getCurrent();return square.hasCl(cl+order)?(square.removeCl(cl),square.removeCl(cl+order)):users.nextUser(),{}}function updateAdd(square,cl){square.addCl(cl),square.addCl(cl+users.getCurrent());let r=square.gAttr("r"),c=square.gAttr("c"),userName=users.getCurrentUser(),current=users.getCurrent();return caro[r][c].state=1,caro[r][c].belongTo=current,users.nextUser(),{r:r,c:c,userName:userName,current:current,checkWin:""}}function checkWin(lastCoord={r:r,c:c,userName:userName,current:current}){let ii,jj,startingRow=parseInt(lastCoord.r),startingCol=parseInt(lastCoord.c),startCoord={},current=lastCoord.current,userName=lastCoord.userName,won=!1,counter=0;for(startCoord.r=startingRow,startCoord.c=startingCol,ii=startingRow,jj=startingCol,counter=1;++ii<amountSquare&&0!=caro[ii][jj].state&&caro[ii][jj].belongTo==current&&++counter;)startCoord.r=ii;if(5==counter)return!0;{let ii=startCoord.r;for(counter=1;--ii>=0&&0!=caro[ii][jj].state&&caro[ii][jj].belongTo==current&&++counter;);if(5==counter)return!0}for(startCoord.r=startingRow,startCoord.c=startingCol,ii=startingCol,jj=startingRow,counter=1;++ii<amountSquare&&0!=caro[jj][ii].state&&caro[jj][ii].belongTo==current&&++counter;)startCoord.c=ii;if(5==counter)return!0;{let ii=startCoord.c;for(counter=1;--ii>=0&&0!=caro[jj][ii].state&&caro[jj][ii].belongTo==current&&++counter;);if(5==counter)return!0}for(startCoord.r=startingRow,startCoord.c=startingCol,ii=startingRow,jj=startingCol,counter=1;++ii<amountSquare&&++jj<amountSquare&&0!=caro[ii][jj].state&&caro[ii][jj].belongTo==current&&++counter;)startCoord.r=ii,startCoord.c=jj;if(5==counter)return!0;{let ii=startCoord.r,jj=startCoord.c;for(counter=1;--ii>=0&&--jj>=0&&0!=caro[ii][jj].state&&caro[ii][jj].belongTo==current&&++counter;);if(5==counter)return!0}for(startCoord.r=startingRow,startCoord.c=startingCol,ii=startingRow,jj=startingCol,counter=1;++ii<amountSquare&&--jj>=0&&0!=caro[ii][jj].state&&caro[ii][jj].belongTo==current&&++counter;)startCoord.r=ii,startCoord.c=jj;if(5==counter)return!0;{let ii=startCoord.r,jj=startCoord.c;for(counter=1;--ii>=0&&++jj<amountSquare&&0!=caro[ii][jj].state&&caro[ii][jj].belongTo==current&&++counter;);if(5==counter)return!0}return!1}getXYFirstTime(),window.addEventListener("touchstart",mdown),window.addEventListener("touchmove",mmove),window.addEventListener("touchend",mup),window.addEventListener("mousedown",mdown),window.addEventListener("mousemove",mmove),window.addEventListener("mouseup",mup)}function init(amount=0){function generateLayout(){caro.splice(0,caro.length);for(let ii=0;ii<amount;ii++){let row=generateRowHtml(),rowArr=[];for(let jj=0;jj<amount;jj++){let sq={state:0,belongTo:null};rowArr.push(sq);let square=generateSquareHtml(ii,jj);row.appendChild(square)}caro.push(rowArr),playGround.appendChild(row)}function generateSquareHtml(r,c){let ele;return cEle("span",{class:"square",style:`height:${squareRes};width:${squareRes}`,r:r,c:c})}function generateRowHtml(){let ele;return cEle("div",{class:"row"})}}generateLayout()}function reAlignCenter(){let w=playGround.offsetWidth/2,h=playGround.offsetHeight/2,pW=window.innerWidth/2,pH=window.innerHeight/2,zoom=1;playGround.style.transform=`translate(${pW-w}px,${pH-h}px)`}function setFullScreen(){$("#full-screen").onclick=function(e){isFullScreen()?document.exitFullscreen():document.body.requestFullscreen()},document.addEventListener("fullscreenchange",e=>{isFullScreen()?$("#full-screen").addCl("active"):$("#full-screen").removeCl("active")})}function initUser(){const userName=$("#user-name");let _min=1,_max=2,current=1,users={1:{name:"Người chơi 1"},2:{name:"Người chơi 2"}};const updateCurrent=()=>{current=current>2?1:current,current=current<1?2:current};return{getCurrent:()=>current,getCurrentUser:()=>users[current].name,nextUser(){current++,updateCurrent(),this.updateDOM()},prevUser(){current--,updateCurrent(),this.updateDOM()},editFirstUser(name=""){users[1].name=name},editSecondUser(name=""){users[2].name=name},updateDOM(){userName.innerText=this.getCurrentUser()}}}function unload(){window.onbeforeunload=()=>""}setFullScreen(),amountSquare&&amountSquare>0&&(init(amountSquare),users.updateDOM(),interact())}const root=$("#root"),playGround=$("#playGround");playGround&&run();